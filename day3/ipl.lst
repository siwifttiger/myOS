     1                                  CYLS EQU 10           ;定义 CYLS等于10
     2                                  	org 0x7c00    ;程序装载地址
     3                                  ;以下程序指明FAT12格式的软盘
     4                                  
     5 00000000 EB4E                    		jmp entry
     6 00000002 90                      		db 0x90
     7 00000003 48454C4C4F49504C        		DB		"HELLOIPL"		;启动区名称 8字节
     8 0000000B 0002                    		DW		512				;每个sector的大小 512字节
     9 0000000D 01                      		DB		1				;簇（cluster）大小 1个扇区
    10 0000000E 0100                    		DW		1				;FAT起始位置
    11 00000010 02                      		DB		2				;FAT个数
    12 00000011 E000                    		DW		224				;根目录大小
    13 00000013 400B                    		DW		2880			;磁盘大小 2880sector
    14 00000015 F0                      		DB		0xf0			;磁盘种类
    15 00000016 0900                    		DW		9				;FAT长度
    16 00000018 1200                    		DW		18				;1 track多少扇区
    17 0000001A 0200                    		DW		2				;磁头数
    18 0000001C 00000000                		DD		0				;不使用分区
    19 00000020 400B0000                		DD		2880			;重写磁盘大小
    20 00000024 000029                  		DB		0,0,0x29		;固定
    21 00000027 FFFFFFFF                		DD		0xffffffff		;卷标
    22 0000002B 57616E6753674F5320-     		DB		"WangSgOS   "	        ;磁盘名称 11字节
    23 00000034 2020               
    24 00000036 4641543132202020        		DB		"FAT12   "		;磁盘格式名称 8字节
    25 0000003E <res 00000012>          		RESB	18				;空18字节
    26          ******************       warning: uninitialized space declared in .text section: zeroing
    27                                  	entry:
    28 00000050 B80000                  		mov ax,0
    29 00000053 8ED0                    		mov ss,ax
    30 00000055 BC007C                  		mov sp,0x7c00
    31 00000058 8ED8                    		mov ds,ax
    32                                  		
    33                                  		
    34                                  ;新增部分 读取软盘第2个扇区
    35 0000005A B82008                  		mov ax,0x0820
    36 0000005D 8EC0                    		mov es,ax                        ;es*16+bx
    37 0000005F B500                    		mov ch,0	                 ;柱面0
    38 00000061 B600                    		mov dh,0                         ;磁头0
    39 00000063 B102                    		mov cl,2                         ;扇区2
    40                                  	readloop:
    41 00000065 BE0000                  		mov si,0                         ;记录失败次数的寄存器 每次读取新的扇区是都会重置为0
    42                                  	retry:
    43 00000068 B402                    		mov ah,0x02                      ;ah=0x02 读盘功能
    44 0000006A B001                    		mov al,1                         ;读一个扇区
    45 0000006C BB0000                  		mov bx,0                         ;es:bx = 缓冲地址 就是内存地址，从软盘读出的数据将要放到这个地址
    46 0000006F B200                    		mov dl,0x00                      ;A驱动器
    47 00000071 CD13                    		int 0x13                         ;调用磁盘BIOS 0x13中断
    48 00000073 7310                    		jnc next                          ;加载成功就跳转到fin
    49 00000075 83C601                  		add si,1                         ;出错就将si加1
    50 00000078 83FE05                  		cmp si,5
    51 0000007B 7331                    		jae error                        ;si >= 5 就跳转到error 报错
    52 0000007D B400                    		mov ah,0x00
    53 0000007F B200                    		mov dl,0x00
    54 00000081 CD13                    		int 0x13                         ;系统复位 重置驱动
    55 00000083 EBE3                    		jmp retry
    56                                  		
    57                                  	next:
    58 00000085 8CC0                    		mov ax,es
    59 00000087 83C020                  		add ax,0x0020                    ;地址加上0x200
    60 0000008A 8EC0                    		mov es,ax                        ;内存因为是es*16+bx所以上面加的是0x20
    61 0000008C 80C101                  		add cl,1
    62 0000008F 80F912                  		cmp cl,18
    63 00000092 76D1                    		jbe readloop                     ;cl <= 18 跳转到readloop 
    64 00000094 B101                    		mov cl,1
    65 00000096 80C601                  		add dh,1
    66 00000099 80FE02                  		cmp dh,2                         ;读取正反两面
    67 0000009C 72C7                    		jb readloop
    68 0000009E B600                    		mov dh,0
    69 000000A0 80C501                  		add ch,1                         ;读完一个柱面正反两个面18个扇区后，柱面号加1
    70 000000A3 80FD0A                  		cmp ch,CYLS                      ;读取10个柱面
    71 000000A6 72BD                    		jb readloop
    72 000000A8 E9(0082)                		jmp 0x8200
    73                                  	fin:
    74 000000AB F4                      		hlt                              ;如果正常加载成功的话，就finish 进入停机状态
    75 000000AC EBFD                    		jmp fin
    76                                  	error:
    77 000000AE BE[C300]                		mov si,msg
    78                                  	putloop:
    79 000000B1 8A04                    		mov al,byte[si]
    80 000000B3 83C601                  		add si,1
    81 000000B6 3C00                    		cmp al,0
    82 000000B8 74F1                    		je fin                           ;输出完提示信息后，也进入停机
    83 000000BA B40E                    		mov ah,0x0e
    84 000000BC BB0F00                  		mov bx,15                        ;显示器处于文本模式，设置颜色并不能起作用
    85 000000BF CD10                    		int 0x10
    86 000000C1 EBEE                    		jmp putloop
    87                                  
    88                                  	msg:
    89 000000C3 0A0A                    		db 0x0a,0x0a
    90 000000C5 6C6F6164206572726F-     		db "load error!"
    91 000000CE 7221               
    92 000000D0 0A                      		db 0x0a
    93 000000D1 00                      		db 0
    94 000000D2 <res 0000012C>          	resb 0x1fe-($-$$)
    95          ******************       warning: uninitialized space declared in .text section: zeroing
    96 000001FE 55AA                    	db 0x55,0xaa		
    97                                  
    98                                  
    99                                  ;启动区以外的输出
   100                                  
   101 00000200 F0FFFF0000000000        		DB		0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00
   102 00000208 <res 000011F8>          		RESB	4600
   103          ******************       warning: uninitialized space declared in .text section: zeroing
   104 00001400 F0FFFF0000000000        		DB		0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00
   105 00001408 <res 00166BF8>          		RESB	1469432
   106          ******************       warning: uninitialized space declared in .text section: zeroing
   107                                  
